import { toNano, address, Address, Cell, Slice, beginCell } from '@ton/core';
import { JettonMinter, MinterConfig } from '../../wrappers/JettonMinter';
import { NetworkProvider } from '@ton/blueprint';
import { buildjettonMinterContentCell } from '../../helpers/metadata';

export async function run(provider: NetworkProvider) {

    // "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"
    const heX: string = "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"
    const cellData: Cell = Cell.fromBase64(heX)
    const sliceData: Slice = cellData.beginParse()

    const total_supply = sliceData.loadCoins()

    const target = 
        beginCell()
            .storeCoins(100000000000000000n)
            .storeSlice(sliceData)
        .endCell()


    console.log('provider.sender().address', provider.sender().address);

    const minter = provider.open(JettonMinter.createFromAddress(address('EQDlGAkFtM_QhI3I3OyMiAG4px-5hUNCt8YEx6Ncfttrl59q')));

    const codeHex: string = "b5ee9c720102150100047e000114ff00f4a413f4bcf2c80b0102016202030202cc040502015811120201d4060700c3b3f0508a08e0a8c00826a82a0a09919606a007f404039e2c039e2d99924391960227e80025e80196019241f200e0e9919605940f97ff93a04722ef22e3c5003191960ab19e2ca007f404472500d92500d7c420479e02052403992261c59992e3f60101e30831c02497c0f8007434c0c05c6c23918c0c600835c874c7c0608405e351466ea44c38601035c87e800c3b51343e803e903e903e903535007e1874541168504d3e10721401be80940133c59633c58073c5b333327b55383e903e900c7e800c5c75c87e800c7e800c1cea6d0000b4c7f4cfe00800113e910c30003cb8536004feed44d0fa00fa40fa40fa40d4d401f861d127c015e3022782107bdd97debae3022782102c76b973ba8ed0375f04048208989680a015bcf2e04b02fa40d3003095c821cf16c9916de28210d1735400708018c8cb055005cf1624fa0214cb6a13cb1f14cb3f23fa4430c000966c227001cb01e30df400c98040fb00e036383824090a0b0c00e23636385350c7055165c70516b1f2e04901fa4021f001fa008209312d005008a05210bef2e04806d43020d0d31f018210178d4519baf2e0488040d721fa00fa4031fa4031fa0031d2000192d431ded154448071f0095004a0441403f841c85006fa025004cf1658cf1601cf16ccccc9ed5401dc37383802fa00fa40f828541207705460041354150504c8cb035003fa0201cf1601cf16ccc921c8cb0113f40012f400cb00c9f9007074c8cb02ca07cbffc9d05007c705f2e04aa146345055f841c85006fa025004cf1658cf1601cf16ccccc9ed54fa403020d70b01c300915be30d0d0070f8284403705460041354150504c8cb035003fa0201cf1601cf16ccc921c8cb0113f40012f400cb00c9f9007074c8cb02ca07cbffc9d0cf1602f4c0038e24345043c705f2e04902fa40305521f841c85006fa025004cf1658cf1601cf16ccccc9ed54e024c0048e253031325124c705f2e0498b02504213f841c85006fa025004cf1658cf1601cf16ccccc9ed54e024c007e302313622c006e3023133c0059e58c705f2e049d4d43001ed54fb04e05f03840ff2f00e0f003e8210d53276db708010c8cb055003cf1622fa0212cb6acb1fcb3fc98042fb00004e34355132c705f2e04902fa403050034414f841c85006fa025004cf1658cf1601cf16ccccc9ed5401fe325324c7055235c70514b1f2e049fa40fa00d43020d0d31fd33f312182100f8a7ea5ba8e20315046c705f2e04904fa0031fa4031fa4031f40431fa0031d2000192d431ded18e34218210595f07bcba9e31343502fa0031fa4031f40431d18e1901c0649c5046c705f2e04904d30331d196303334f2c048e213e213e2503370100004f0090201661314002db8e4bed44d0fa00fa40fa40fa40d4d401f861d1145f0480095adbcf6a2687d007d207d207d206a6a00fc30e8b620fc1400b82a300209aa0a8282646581a801fd0100e78b00e78b666490e4658089fa00097a00658064fc80383a6465816503e5ffe4e8400035af16f6a2687d007d207d207d206a6a00fc30e8b610bffc20a181c0"
    const cellCode: Cell = Cell.fromHex(codeHex) 

        
    await minter.sendUpgrade(provider.sender(), {
        value: toNano("0.05"),
        queryId: BigInt(Math.floor(Date.now() / 1000)),
        newCode: cellCode,
        newData: target,
    });

}
